# Nurseryのインストールと設定


## 1. Nurseryのダウンロード

zipファイルを解凍し、適当な場所に置きます。

`plugins`フォルダ内にあるdllファイルを右クリックし、プロパティを表示します。[全般]タブの一番下に「許可する」のチェックボックスがある場合、チェックしてOKを押します。（`plugins`フォルダ内のdllファイルすべてに同じ作業を行ってください。）


## 2. 棒読みちゃんのインストール

* [棒読みちゃん](http://chi.usamimi.info/Program/Application/BouyomiChan/)

### インストールと動作確認

zipをダウンロードし、解凍して適当な場所に置きます。

`BouyomiChan.exe`を起動します。

初回に限り、`初回確認：〇〇プラグイン`というダイアログがいくつか出てきます。すべて「いいえ」を選択します。

棒読みちゃんのメイン画面が表示されたら、中央の広いテキストエリアに適当な文章を入力し、左上の「音声合成」ボタン（フキダシに緑色の三角がついたボタン）を押します。

入力した文章が読み上げられれば、正常にインストールが完了しています。棒読みちゃんを終了してください。


## 3. 仮想サウンドデバイスのインストール

仮想サウンドデバイスとは、大雑把に言えば「マイクとスピーカーのフリをするソフトウェア」です。

Nurseryではまず、棒読みちゃんの音声を「スピーカーのフリ」をした仮想サウンドデバイスに流すよう設定します。そして、同じ仮想サウンドデバイスに「マイクのフリ」をさせることで、読み上げ音声をDiscordのボイスチャンネルに流します。

ここでは、仮想サウンドデバイスとして[NETDUETTO](https://www.netduetto.net/)に付属するデバイスを使用します。

* [ダウンロード | NETDUETTO](https://www.netduetto.net/download/)

上記のリンクからNETDUETTOをダウンロード・インストールします。


## 4. 棒読みちゃんの設定

### コマンドの有効化

棒読みちゃんの便利なコマンドを有効化します。（コマンドを使用しない場合は飛ばしてかまいません）

1. 棒読みちゃんを起動し、設定画面の表示ボタン（スパナのアイコン）をクリックします。「棒読みちゃん 基本設定」画面が表示されます。
2. [配信者向け機能] を選択します。「配信者向け機能を有効にする」の項目を「 **True** 」にします。
3. [配信者向け機能] - [文字数制限] を選択します。「文字数制限機能を有効にする」の項目を「 **False** 」にします。
4. [配信者向け機能] - [自動加速] を選択します。「自動加速機能を有効にする」の項目を「 **False** 」にします。
5. [配信者向け機能] - [自動スキップ] を選択します。「自動スキップ機能を有効にする」の項目を「 **False** 」にします。
6. [配信者向け機能] - [タグ] を選択します。「タグを有効にする」の項目を「 **True** 」にします。
7. [配信者向け機能] - [タグ] - [Sound/SoundW（再生）] を選択します。「タグを有効にする」の項目を「 **False** 」にします。
8. [配信者向け機能] - [タグ] - [Command/CommandW（コマンド実行）] を選択します。「タグを有効にする」の項目を「 **False** 」にします。
9. [OK]を押して設定画面を閉じます。

手順で説明したもの以外の[配信者向け機能] - [タグ] 内の項目は、自由に設定してください。
基本的には初期値のままでかまいませんが、荒らしに困るようなら機能をオフにしてください。

設定が終わったら、棒読みちゃんの画面で`g)こんにちは`などと入力して読ませ、コマンドの設定が反映されているか確認してください。

### 教育ファイルの共有

他の人から教育データのファイル（`ReplaceStudy.dic`）をもらっている場合は、棒読みちゃんを一度終了させてから、棒読みちゃんのフォルダに上書きコピーします。

棒読みちゃんを起動し[辞書登録]タブ - [教育]タブにデータが入っていることを確認します。

### 出力先の設定

インストールした仮想サウンドデバイスを使うように、棒読みちゃんを設定します。

1. 棒読みちゃんを起動し、設定画面の表示ボタン（スパナのアイコン）をクリックします。「棒読みちゃん 基本設定」画面が表示されます。
2. [システム] - [音声出力デバイス] を選択します。右側のリストに、スピーカーやヘッドホンのリストが表示されます。（内容は接続機器や環境によって異なります。）
3. リストから`Yamaha NETDUETTO Driver`の表記がある行を探し、ダブルクリックします。
4. [OK]を押して設定画面を閉じます。

設定が終わったら、棒読みちゃんの画面で適当な文章を入力し、読ませてみてください。 **出力デバイスを正しく仮想サウンドデバイスに設定できている場合は、読み上げ音声が聞こえません**。


## 5. Discord botアカウント

すでにbotアカウントを準備してある人は不要です。

### Botアカウントの作成

* [Discord - 開発者向けドキュメント](https://discordapp.com/developers/docs/intro)

1. Discordサイトの上記のページにアクセスし、必要ならDiscordのアカウントでログインします。
2. 左のメニューから[申請] - [マイアプリ]を選択します。
3. [新しいアプリ]をクリックします。「新しいアプリ」画面が開きます。
4. 「アプリケーション名」にbotの名前を入力します。（例：`voice-bot` `nursery-bot`など）
5. 「アプリを作成」ボタンを押します。
6. 画面を下までスクロールし、[Bot]の「Botユーザーを作成」ボタンを押します。「このアプリにBOTを追加しますか？」ダイアログで「実行します！」ボタンを押します。

Discordサイトのこの画面はまだ使うので開いたままにしておいてください。

### Botの招待

1. DiscordサイトのBot画面に戻り、[アプリの詳細] - [クライアント ID] の文字列を確認します。
2. 下記のURLの「クライアントIDをここに入れる」に1のクライアントIDを入れて、ブラウザでアクセスします。
  `https://discordapp.com/oauth2/authorize?&client_id=クライアントIDをここに入れる&scope=bot&permissions=0`
3. 「Discordに接続」の画面が表示されるので、bot名が正しいことを確認します。「Botを追加します」の項目で、招待するサーバーを選択します。（※自分が招待権限を持っていないサーバーは選べません！管理者にお願いしてください。）
4. 「認証」ボタンを押します。必要に応じて機械確認を行ってください。
5. 「認証しました」が表示されたら、招待完了です。

招待が完了したら、Discordのアプリ上で該当サーバーのメンバーにbotアカウントが追加されていることを確認します。（オフライン状態）

### BotをNurseryに登録

1. DiscordサイトのBot画面に戻り、[Bot] - [アプリのBotユーザー] - [トークン] の「クリックして表示」をクリックします。表示されたトークンの文字列をコピーします。
2. Nurseryのフォルダにある`config.json`をメモ帳などで開きます。
3. 2行目の`"token": "ここにBotのトークンを貼り付け",`に、コピーしたトークン文字列を貼り付けます。 **両端の`"`を削除しない**ように注意してください。また、不要なスペースが入らないよう注意してください。
4. 上書き保存してメモ帳を閉じます。


## 6. Nurseryの起動・終了

### 起動

1. 棒読みちゃんを起動しておきます。（最小化してかまいません）
2. `Nursery.exe`を起動します。

画面に以下のように表示されたら起動完了です。

```
Done!
/////////////
// Nursery //
/////////////
```

### 終了

1. `Nursery.exe`の画面に`exit`と入力してEnterキーを押します。
2. Nurseryが終了します。

### 仮想サウンドデバイスの名前が違う場合

起動時に以下のエラーが出る場合、仮想サウンドデバイスの名前が標準と異なる可能性があります。（ほとんどの場合は同じ名前ですが、OSや他ソフトの影響で名前が異なる場合があります。）

```
System.Exception: Could not initialize sound devices. Please check virtual devices installed and valid name set.
```

この場合、その下に以下のような表示が出ます：

```
Available recording devices:
 * ライン (Yamaha NETDUETTO Driver (WDM))
```

ここにリスト表示された名前から仮想サウンドデバイスの名前を探し、コピーしてください。（上記の例では`ライン (Yamaha NETDUETTO Driver (WDM))`）

その後、以下の手順で、コピーした値を設定ファイルに上書きします。

1. Nurseryのフォルダにある`config.json`をメモ帳などで開きます。
2. 3行目と4行目の`device_read`と`device_sound_effect`の値に、コピーした仮想サウンドデバイス名を貼り付けます。
3. 上書き保存してメモ帳を閉じます。
